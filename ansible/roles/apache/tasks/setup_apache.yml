---
# with 2.2 it will be soo cool

- name: load current status of apache service
  command: systemctl status httpd.service
  register: httpd_status
  changed_when: false
  ignore_errors: yes
  # systemctl status returns exit code 3 if the status is inactiv
  # since the error code is not 0 ansible will return an Error

- name: systemctl start apache service
  become: true
  command: systemctl start httpd.service
  when: not {{httpd_status.stdout  | search("active \(running\)") }}

- name: systemctl add apache service to boot sequence
  become: true
  command: systemctl enable httpd.service
  when: not {{httpd_status.stdout  | search("enabled;") }}

- name: open port 80 (http)
  become: true
  iptables:
    chain: INPUT
    protocol: tcp
    jump: ACCEPT
    destination_port: 80
    ctstate: NEW

- name: open port 443 (https)
  become: true
  iptables:
    chain: INPUT
    protocol: tcp
    jump: ACCEPT
    destination_port: 443
    ctstate: NEW
